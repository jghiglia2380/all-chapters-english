<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L-46: Automobile Finance - Buying vs. Leasing | PFL Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Core component styles */
        .learning-objectives {
            background-color: #e6f3ff;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .discussion-prompt {
            background-color: #e6f0ff;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #3b82f6;
        }

        .case-study {
            background-color: #f0f9ff;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid #0ea5e9;
        }

        .skill-builder {
            background-color: #f3e8ff;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .key-concept {
            background-color: #fef3c7;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.75rem 0;
            border-left: 4px solid #f59e0b;
        }

        /* Activity timer */
        .activity-timer {
            background-color: #FFFBEB;
            border-left: 4px solid #F59E0B;
            padding: 0.75rem 1rem;
            margin: 1rem 0;
            font-weight: 500;
        }

        /* State variable highlight */
        .state-variable {
            background-color: #dbeafe;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        /* Wizard styles */
        .wizard-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        .wizard-step {
            flex: 1;
            text-align: center;
            padding: 1rem;
            background: #f3f4f6;
            border-radius: 0.5rem;
            margin: 0 0.25rem;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wizard-step.active {
            background: #4F46E5;
            color: white;
            font-weight: bold;
        }

        .wizard-step.completed {
            background: #10b981;
            color: white;
        }

        .wizard-step.completed::after {
            content: '‚úì';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.875rem;
        }

        .wizard-content {
            display: none;
        }

        .wizard-content.active {
            display: block;
        }

        /* Responsive wizard for mobile */
        @media (max-width: 768px) {
            .wizard-nav {
                flex-wrap: wrap;
            }
            .wizard-step {
                flex: 1 1 30%;
                margin-bottom: 0.5rem;
                font-size: 0.875rem;
                padding: 0.75rem 0.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Fixed Header - Purple with Navigation -->
    <header class="bg-indigo-600 text-white p-4 shadow-md fixed top-0 left-0 right-0 z-40">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">PFL Academy</h1>
            <nav class="hidden md:block">
                <ul class="flex space-x-6">
                    <li><a href="#" class="text-white hover:text-indigo-200">Home</a></li>
                    <li><a href="#" class="text-white hover:text-indigo-200">Curriculum</a></li>
                    <li><a href="#" class="text-white hover:text-indigo-200">Resources</a></li>
                    <li><a href="#" class="text-white hover:text-indigo-200">Profile</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Spacer to push content below fixed header -->
    <div class="h-16"></div>

    <div class="container mx-auto px-4 py-8 grid lg:grid-cols-10 gap-8">
        <!-- Left Navigation Sidebar -->
        <div class="lg:col-span-3 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Financial Decisions</h2>
            <p class="text-gray-600 mb-6">Making informed choices about major purchases and financing</p>

            <!-- Chapter Navigation -->
            <nav class="space-y-2" aria-label="Chapters">
                <!-- Current chapter with blue left border -->
                <a href="#" class="w-full flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-indigo-50 text-indigo-700 border-l-4 border-indigo-700">
                    <span class="mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                    </span>
                    <span class="text-left">L-46 Automobile Finance</span>
                </a>

                <!-- Section navigation -->
                <div class="ml-6 space-y-1 mt-1">
                    <a href="#intro" class="text-indigo-700 font-medium flex items-center">
                        <span class="mr-2">‚Ä¢</span> Introduction
                    </a>
                    <a href="#key-concepts" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Key Concepts
                    </a>
                    <a href="#buying" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Understanding Buying
                    </a>
                    <a href="#leasing" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Understanding Leasing
                    </a>
                    <a href="#comparing" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Comparing TCO
                    </a>
                    <a href="#implications" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Financial Implications
                    </a>
                    <a href="#examples" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Real-World Examples
                    </a>
                    <a href="#reflection" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Reflection
                    </a>
                    <a href="#skill-builder" class="text-gray-700 hover:text-indigo-700 flex items-center">
                        <span class="mr-2">‚Ä¢</span> Skill Builder
                    </a>
                </div>
            </nav>

            <div class="mt-8 bg-gradient-to-r from-indigo-100 to-indigo-200 rounded-lg p-4">
                <h3 class="text-lg font-semibold text-indigo-800 mb-2">Your Progress</h3>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                    <div class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%" id="progressBar"></div>
                </div>
                <p class="text-sm text-indigo-800">Completed: <span class="font-medium" id="progressText">0/9 sections</span></p>
            </div>

            <div class="mt-8">
                <a href="day2.html" class="block text-center bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
                    Preview Day 2 Learning Lab ‚Üí
                </a>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="lg:col-span-7 bg-white rounded-lg shadow p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">L-46: Automobile Finance - Buying vs. Leasing</h1>

            <!-- Learning Objectives -->
            <div class="learning-objectives" id="intro">
                <h2 class="text-xl font-semibold text-gray-900 mb-3">Learning Objectives</h2>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>Analyze the financial differences between buying and leasing a vehicle</li>
                    <li>Calculate the total cost of ownership for different financing scenarios</li>
                    <li>Evaluate how vehicle financing decisions impact overall financial health</li>
                    <li>Compare loan terms, interest rates, and their effects on total vehicle costs</li>
                    <li>Make informed decisions about vehicle acquisition aligned with personal financial goals</li>
                </ul>
            </div>

            <!-- Introduction -->
            <section class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Introduction</h2>
                <p class="text-gray-700 mb-4">
                    For most Americans, purchasing or leasing a vehicle represents one of the largest financial decisions they'll make, second only to housing. The average new car costs over $48,000, and the financing method you choose can result in thousands of dollars in difference over the life of your ownership. Whether you're buying your first car or upgrading to a newer model, understanding the financial implications of buying versus leasing is crucial to making a decision that supports your long-term financial goals.
                </p>
                <p class="text-gray-700 mb-4">
                    Many young adults approach vehicle acquisition with excitement but little understanding of the complete financial picture. The advertised monthly payment is only one piece of a complex puzzle that includes interest rates, loan terms, insurance costs, maintenance, depreciation, and opportunity costs. A decision that seems affordable month-to-month can become a significant financial burden when viewed holistically.
                </p>
                <p class="text-gray-700">
                    The choice between buying and leasing isn't simply about which option costs less‚Äîit's about which option aligns best with your financial situation, driving needs, and long-term goals. Some situations favor buying, while others make leasing more advantageous. Understanding the complete financial landscape empowers you to make informed decisions that serve your broader financial wellbeing rather than simply minimizing your monthly payment.
                </p>
            </section>

            <!-- Key Concepts -->
            <section class="mb-8" id="key-concepts">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Key Concepts</h2>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Auto Loan</h3>
                    <p class="text-gray-700 text-sm">A secured loan where the vehicle serves as collateral, allowing you to purchase a car by making monthly payments over a set period, typically 36-72 months</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Lease</h3>
                    <p class="text-gray-700 text-sm">A contract that allows you to use a vehicle for a specified period (usually 24-36 months) by making monthly payments, after which you return the vehicle or have the option to purchase it</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Depreciation</h3>
                    <p class="text-gray-700 text-sm">The decrease in a vehicle's value over time due to age, mileage, and wear; new cars typically lose 20-30% of their value in the first year</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Total Cost of Ownership (TCO)</h3>
                    <p class="text-gray-700 text-sm">The complete financial cost of owning or leasing a vehicle, including purchase price, financing costs, insurance, fuel, maintenance, repairs, and depreciation</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Capitalized Cost</h3>
                    <p class="text-gray-700 text-sm">In leasing, the negotiated price of the vehicle that determines your lease payments; similar to the purchase price when buying</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Residual Value</h3>
                    <p class="text-gray-700 text-sm">The estimated value of a leased vehicle at the end of the lease term, which affects monthly payment calculations</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Money Factor</h3>
                    <p class="text-gray-700 text-sm">The interest rate in a lease agreement, expressed as a decimal rather than a percentage; multiply by 2,400 to convert to APR</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Gap Insurance</h3>
                    <p class="text-gray-700 text-sm">Coverage that pays the difference between what you owe on a vehicle and its actual cash value if the car is totaled or stolen</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Equity</h3>
                    <p class="text-gray-700 text-sm">The difference between what your vehicle is worth and what you owe on it; positive equity means you own more than you owe</p>
                </div>

                <div class="key-concept">
                    <h3 class="font-semibold text-gray-900">Opportunity Cost</h3>
                    <p class="text-gray-700 text-sm">The potential financial gain you could have achieved by investing money elsewhere instead of putting it toward a vehicle</p>
                </div>
            </section>

            <!-- Deeper Exploration -->
            <section class="mb-8" id="buying">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Understanding Vehicle Buying</h2>
                <p class="text-gray-700 mb-4">
                    When you buy a vehicle, whether with cash or a loan, you are purchasing an asset that you own outright (or will own once the loan is paid off). Auto loans are secured loans, meaning the vehicle itself serves as collateral‚Äîif you fail to make payments, the lender can repossess the vehicle. Most auto loans range from 36 to 72 months, though longer terms of up to 84 months have become increasingly common.
                </p>
                <p class="text-gray-700 mb-4">
                    The financial dynamics of buying involve several key considerations. First, you'll typically make a down payment of 10-20% of the vehicle's purchase price, though this varies. Your monthly payment is determined by the loan amount, interest rate, and loan term. Lower interest rates and shorter loan terms result in lower total interest paid, but higher monthly payments. Conversely, longer loan terms reduce monthly payments but substantially increase the total interest paid over the life of the loan.
                </p>
                <p class="text-gray-700">
                    One of the most significant aspects of vehicle ownership is depreciation. New cars lose approximately 20-30% of their value in the first year, and about 60% by the fifth year. This means a $40,000 vehicle could be worth only $16,000 after five years, representing a $24,000 loss in value. However, once you own the vehicle outright, you can continue driving it without monthly payments, potentially for many years, which can make buying financially advantageous in the long run.
                </p>
            </section>

            <section class="mb-8" id="leasing">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Understanding Vehicle Leasing</h2>
                <p class="text-gray-700 mb-4">
                    Leasing a vehicle is fundamentally different from buying‚Äîyou're essentially renting the vehicle for a set period, typically 24-36 months. Your monthly lease payments cover the vehicle's depreciation during the lease term, plus interest (expressed as a "money factor") and fees. At the end of the lease, you return the vehicle unless you choose to purchase it for the predetermined residual value.
                </p>
                <p class="text-gray-700 mb-4">
                    Leases typically require a smaller upfront payment than buying, sometimes called a "cap cost reduction," though zero-down leases are also available. Monthly lease payments are generally lower than loan payments for the same vehicle because you're only paying for a portion of the vehicle's value‚Äîthe depreciation during your lease term‚Äîrather than the entire purchase price.
                </p>
                <p class="text-gray-700">
                    However, leases come with significant restrictions. Most leases limit you to 10,000-15,000 miles per year, with substantial penalties (typically $0.15-$0.30 per mile) for exceeding these limits. You're also responsible for maintaining the vehicle in excellent condition; excessive wear and tear will result in additional charges when you return it. Furthermore, you cannot modify the vehicle, and you're essentially locked into the lease term‚Äîearly termination can be extremely expensive.
                </p>
            </section>

            <section class="mb-8" id="comparing">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Comparing Total Cost of Ownership</h2>
                <p class="text-gray-700 mb-4">
                    The true financial comparison between buying and leasing requires examining the total cost of ownership over your expected period of vehicle use. For buying, this includes the purchase price, financing costs, insurance, fuel, maintenance, repairs, and the vehicle's residual value when you eventually sell or trade it. For leasing, it includes all lease payments, any acquisition fees, disposition fees, potential mileage overages, excess wear charges, and the fact that you have no asset at the end of the lease term.
                </p>
                <p class="text-gray-700 mb-4">
                    Consider a $35,000 vehicle over six years. If you buy with a 5% loan over 60 months, you'll pay approximately $41,166 total (including interest), but you'll own an asset worth roughly $14,000, making your net cost $27,166. If you lease the same vehicle twice (two 3-year leases) at $400/month, you'll pay $28,800 in lease payments, plus potential fees and overages, and you'll have no asset at the end‚Äîa net cost of $30,000 or more.
                </p>
                <p class="text-gray-700">
                    However, this simplified comparison doesn't account for several factors that might favor leasing for some individuals: leases typically include warranty coverage for the entire lease term, potentially reducing maintenance costs; leasing allows you to drive a newer vehicle with the latest safety features and technology; and for business owners, lease payments may offer tax advantages.
                </p>
            </section>

            <section class="mb-8" id="implications">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Implications & Importance</h2>
                <p class="text-gray-700 mb-4">
                    Vehicle financing decisions have far-reaching implications for your overall financial health. A car payment that consumes 15-20% or more of your take-home pay can severely limit your ability to save for emergencies, invest for retirement, or achieve other financial goals. The average American spends over $700 per month on vehicle costs including payments, insurance, fuel, and maintenance‚Äîthat's $8,400 per year, or potentially $100,000 over a decade.
                </p>
                <p class="text-gray-700 mb-4">
                    The decision to buy or lease also affects your financial flexibility. Owning a vehicle outright provides an asset you can sell if needed and eliminates monthly payments once the loan is paid off. Leasing keeps you in a perpetual payment cycle but provides flexibility to change vehicles every few years without the hassle of selling. For young adults, understanding these tradeoffs is crucial to making decisions aligned with career changes, relocations, or changing family needs.
                </p>
                <p class="text-gray-700 mb-4">
                    Moreover, the interest rate you secure on an auto loan is often influenced by your credit score, making this an important arena where your credit history directly impacts your finances. A borrower with excellent credit might secure a 3% interest rate, while someone with poor credit could face rates of 10% or higher‚Äîon a $30,000 loan, this difference amounts to thousands of dollars over the life of the loan.
                </p>
                <p class="text-gray-700">
                    The opportunity cost of vehicle spending is perhaps the most overlooked factor. Money spent on a new car depreciates immediately and generates no investment return. If instead of making a $500 monthly car payment, you drove a reliable used car (paid off) and invested that $500 monthly for 30 years at a 7% average return, you would accumulate approximately $600,000. Understanding these trade-offs helps contextualize vehicle decisions within your broader financial picture.
                </p>
            </section>

            <!-- Real-World Examples -->
            <section class="mb-8" id="examples">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Real-World Examples</h2>

                <div class="case-study mb-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-3">üìä Mia's Buy-and-Keep Strategy</h3>
                    <p class="text-gray-700 mb-3">
                        Mia graduated college and needed a reliable vehicle for her new job. She considered leasing a new SUV for $450/month but instead purchased a certified pre-owned sedan for $18,000 with a $3,000 down payment. She financed $15,000 at 4.5% over 48 months, resulting in payments of $342/month.
                    </p>
                    <p class="text-gray-700 mb-3">
                        After four years, Mia owned her vehicle outright and it was worth approximately $10,000. For the next three years, she drove the same car payment-free while saving $342/month. Over seven years, Mia spent $19,416 in payments (plus her $3,000 down payment) but owned an asset worth $10,000, for a net cost of $12,416‚Äîand she still had a reliable vehicle.
                    </p>
                    <p class="text-gray-700 font-semibold">
                        Result: Her monthly savings of $342 for three years totaled $12,312 in saved payments, which she invested in her retirement account. By choosing to buy and keep a vehicle long-term, Mia both minimized her transportation costs and accelerated her wealth-building.
                    </p>
                </div>

                <div class="case-study mb-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-3">üìä James's Perpetual Lease Cycle</h3>
                    <p class="text-gray-700 mb-3">
                        James loved having the newest vehicle with the latest technology and safety features. He leased a new truck for $499/month with $2,000 down on a 36-month lease. When that lease ended, he leased another new truck for $525/month with another $2,000 down.
                    </p>
                    <p class="text-gray-700 mb-3">
                        Over six years, James paid $36,864 in lease payments plus $4,000 in down payments, totaling $40,864, with no asset at the end. Additionally, he was charged $1,200 in excess mileage fees and $800 in excess wear charges over the two leases.
                    </p>
                    <p class="text-gray-700 font-semibold">
                        Result: His total cost was $42,864 with nothing to show for it. While James enjoyed always driving a new vehicle under warranty, his perpetual lease cycle prevented him from ever having a period without monthly payments and left him with no built equity or ownership‚Äîa pattern that, if continued, could cost him hundreds of thousands over his lifetime while providing no lasting asset.
                    </p>
                </div>

                <div class="case-study">
                    <h3 class="text-xl font-semibold text-gray-900 mb-3">üìä Taylor's Strategic Balance</h3>
                    <p class="text-gray-700 mb-3">
                        Taylor evaluated both buying and leasing before deciding. She determined she needed a reliable vehicle for at least eight years but also valued having modern safety features. She bought a new, fuel-efficient sedan for $28,000 with $5,000 down, financing $23,000 at 3.8% over 60 months with a monthly payment of $423.
                    </p>
                    <p class="text-gray-700 mb-3">
                        After five years, she owned her car outright (worth about $11,000) and had paid approximately $30,380 total. She then drove the car payment-free for three more years while saving her previous $423/month payment. Over eight years, her net cost was approximately $19,380 (accounting for the car's value), and she'd saved $15,228 by not having payments for three years.
                    </p>
                    <p class="text-gray-700 font-semibold">
                        Result: Taylor then traded in her vehicle for $7,000 and bought another reliable used car, continuing her pattern of ownership rather than leasing. This strategy gave her the benefits of a new car with modern features while ultimately minimizing long-term costs through ownership.
                    </p>
                </div>
            </section>

            <!-- Reflection -->
            <div class="discussion-prompt" id="reflection">
                <h3 class="text-xl font-semibold text-gray-900 mb-3">üí≠ Reflection Prompt</h3>
                <p class="text-gray-700">
                    Consider your anticipated vehicle needs over the next 5-10 years. Given your financial situation, career stage, and lifestyle, which financing approach (buying new, buying used, or leasing) might best align with your goals? How might your decision affect your ability to achieve other financial priorities like building an emergency fund, saving for a home, or investing for retirement? What factors beyond the monthly payment should influence your decision?
                </p>
            </div>

            <!-- Skill Builder: 6-Step Wizard -->
            <div class="skill-builder" id="skill-builder">
                <div class="activity-timer mb-4">
                    ‚è±Ô∏è Activity Time: 25 minutes
                </div>

                <h2 class="text-2xl font-bold text-gray-900 mb-4">üöó Auto Finance Decision Calculator</h2>
                <p class="text-gray-700 mb-6">
                    Use this interactive 6-step wizard to compare the complete financial picture of buying versus leasing a vehicle. Work through each step to make an informed decision based on YOUR specific situation.
                </p>

                <!-- Wizard Navigation -->
                <div class="wizard-nav">
                    <div class="wizard-step active" onclick="goToStep(1)" id="step-tab-1">
                        <div class="text-sm font-semibold">Step 1</div>
                        <div class="text-xs">Vehicle Selection</div>
                    </div>
                    <div class="wizard-step" onclick="goToStep(2)" id="step-tab-2">
                        <div class="text-sm font-semibold">Step 2</div>
                        <div class="text-xs">Buy New</div>
                    </div>
                    <div class="wizard-step" onclick="goToStep(3)" id="step-tab-3">
                        <div class="text-sm font-semibold">Step 3</div>
                        <div class="text-xs">Buy Used/CPO</div>
                    </div>
                    <div class="wizard-step" onclick="goToStep(4)" id="step-tab-4">
                        <div class="text-sm font-semibold">Step 4</div>
                        <div class="text-xs">Lease</div>
                    </div>
                    <div class="wizard-step" onclick="goToStep(5)" id="step-tab-5">
                        <div class="text-sm font-semibold">Step 5</div>
                        <div class="text-xs">6-Year Comparison</div>
                    </div>
                    <div class="wizard-step" onclick="goToStep(6)" id="step-tab-6">
                        <div class="text-sm font-semibold">Step 6</div>
                        <div class="text-xs">Recommendation</div>
                    </div>
                </div>

                <!-- Step 1: Vehicle Selection -->
                <div class="wizard-content active" id="step-1">
                    <div class="bg-white p-6 rounded-lg border-2 border-indigo-200">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Step 1: Vehicle Selection</h3>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="vehicleType" value="sedan" class="mr-2" checked>
                                    <span>Sedan (Most fuel-efficient)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="vehicleType" value="suv" class="mr-2">
                                    <span>SUV (More space, higher cost)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="vehicleType" value="truck" class="mr-2">
                                    <span>Truck (Utility, highest cost)</span>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Condition</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="vehicleCondition" value="new" class="mr-2" checked>
                                    <span>New (Highest price, full warranty)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="vehicleCondition" value="cpo" class="mr-2">
                                    <span>Certified Pre-Owned (Inspected, partial warranty)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="vehicleCondition" value="used" class="mr-2">
                                    <span>Used (Best value, no warranty)</span>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Target Price Range ($)</label>
                            <input type="number" id="targetPrice" value="30000" class="w-full p-2 border border-gray-300 rounded" placeholder="30000">
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400 mb-4">
                            <p class="text-sm text-gray-700">
                                <strong>üí° Research Tip:</strong> Research vehicles in <span class="state-variable">{{STATE_NAME}}</span> at
                                <a href="https://www.cars.com" target="_blank" class="text-blue-600 underline">Cars.com</a> or
                                <a href="https://www.autotrader.com" target="_blank" class="text-blue-600 underline">AutoTrader</a>
                            </p>
                        </div>

                        <button onclick="nextStep()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                            Next: Calculate Buy New Scenario ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Step 2: Buy New Scenario -->
                <div class="wizard-content" id="step-2">
                    <div class="bg-white p-6 rounded-lg border-2 border-green-200">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Step 2: Buy New Scenario</h3>

                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Price ($)</label>
                                <input type="number" id="newPrice" value="30000" oninput="calculateBuyNew()" class="w-full p-2 border border-gray-300 rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Down Payment (%)</label>
                                <input type="number" id="newDown" value="20" oninput="calculateBuyNew()" class="w-full p-2 border border-gray-300 rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Loan Term (months)</label>
                                <select id="newTerm" onchange="calculateBuyNew()" class="w-full p-2 border border-gray-300 rounded">
                                    <option value="36">36 months</option>
                                    <option value="48">48 months</option>
                                    <option value="60" selected>60 months</option>
                                    <option value="72">72 months</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">APR (%)</label>
                                <input type="number" step="0.1" id="newAPR" value="5.8" oninput="calculateBuyNew()" class="w-full p-2 border border-gray-300 rounded">
                                <p class="text-xs text-gray-500 mt-1">State avg new: <span class="state-variable">{{AVG_AUTO_LOAN_RATE_NEW}}%</span></p>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-gray-900 mb-2">Additional Costs Included:</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>‚Ä¢ Registration: <span class="state-variable">{{REGISTRATION_INITIAL}}</span></li>
                                <li>‚Ä¢ Sales Tax: <span class="state-variable">{{SALES_TAX}}%</span></li>
                                <li>‚Ä¢ Documentation Fee: $500</li>
                            </ul>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg mb-4">
                            <div class="grid md:grid-cols-3 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600">Monthly Payment</p>
                                    <p class="text-xl font-bold text-green-700" id="newMonthly">$0</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">Total Interest</p>
                                    <p class="text-xl font-bold text-red-600" id="newInterest">$0</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">Total Cost</p>
                                    <p class="text-xl font-bold text-gray-900" id="newTotal">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button onclick="prevStep()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
                                ‚Üê Previous
                            </button>
                            <button onclick="nextStep()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                                Next: Buy Used Scenario ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Buy Used/CPO Scenario -->
                <div class="wizard-content" id="step-3">
                    <div class="bg-white p-6 rounded-lg border-2 border-blue-200">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Step 3: Buy Used/CPO Scenario</h3>

                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Price ($)</label>
                                <input type="number" id="usedPrice" value="20000" oninput="calculateBuyUsed()" class="w-full p-2 border border-gray-300 rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Down Payment (%)</label>
                                <input type="number" id="usedDown" value="10" oninput="calculateBuyUsed()" class="w-full p-2 border border-gray-300 rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Loan Term (months)</label>
                                <select id="usedTerm" onchange="calculateBuyUsed()" class="w-full p-2 border border-gray-300 rounded">
                                    <option value="36">36 months</option>
                                    <option value="48" selected>48 months</option>
                                    <option value="60">60 months</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">APR (%)</label>
                                <input type="number" step="0.1" id="usedAPR" value="7.2" oninput="calculateBuyUsed()" class="w-full p-2 border border-gray-300 rounded">
                                <p class="text-xs text-gray-500 mt-1">State avg used: <span class="state-variable">{{AVG_AUTO_LOAN_RATE_USED}}%</span></p>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-gray-900 mb-2">Additional Costs Included:</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>‚Ä¢ Registration: <span class="state-variable">{{REGISTRATION_INITIAL}}</span></li>
                                <li>‚Ä¢ Sales Tax: <span class="state-variable">{{SALES_TAX}}%</span></li>
                            </ul>
                        </div>

                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="grid md:grid-cols-3 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600">Monthly Payment</p>
                                    <p class="text-xl font-bold text-blue-700" id="usedMonthly">$0</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">Total Interest</p>
                                    <p class="text-xl font-bold text-red-600" id="usedInterest">$0</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">Total Cost</p>
                                    <p class="text-xl font-bold text-gray-900" id="usedTotal">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button onclick="prevStep()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
                                ‚Üê Previous
                            </button>
                            <button onclick="nextStep()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                                Next: Lease Scenario ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Lease Scenario -->
                <div class="wizard-content" id="step-4">
                    <div class="bg-white p-6 rounded-lg border-2 border-purple-200">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Step 4: Lease Scenario</h3>

                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">MSRP ($)</label>
                                <input type="number" id="leaseMSRP" value="30000" oninput="calculateLease()" class="w-full p-2 border border-gray-300 rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Capitalized Cost ($)</label>
                                <input type="number" id="leaseCapCost" value="28000" oninput="calculateLease()" class="w-full p-2 border border-gray-300 rounded">
                                <p class="text-xs text-gray-500 mt-1">Negotiated price</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Residual Value (%)</label>
                                <input type="number" id="leaseResidual" value="60" oninput="calculateLease()" class="w-full p-2 border border-gray-300 rounded">
                                <p class="text-xs text-gray-500 mt-1">Typical: 55-65%</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Money Factor</label>
                                <input type="number" step="0.00001" id="leaseMoneyFactor" value="0.00250" oninput="calculateLease()" class="w-full p-2 border border-gray-300 rounded">
                                <p class="text-xs text-gray-500 mt-1">√ó2400 = <span id="leaseAPR">6.0</span>% APR</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Term (months)</label>
                                <select id="leaseTerm" onchange="calculateLease()" class="w-full p-2 border border-gray-300 rounded">
                                    <option value="24">24 months</option>
                                    <option value="36" selected>36 months</option>
                                    <option value="48">48 months</option>
                                </select>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-gray-900 mb-2">Additional Costs Included:</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>‚Ä¢ Annual Registration: <span class="state-variable">{{REGISTRATION_ANNUAL}}</span></li>
                                <li>‚Ä¢ Sales Tax on Payment: <span class="state-variable">{{SALES_TAX}}%</span></li>
                                <li>‚Ä¢ Disposition Fee: $500</li>
                            </ul>
                        </div>

                        <div class="bg-purple-50 p-4 rounded-lg mb-4">
                            <div class="grid md:grid-cols-3 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600">Monthly Payment</p>
                                    <p class="text-xl font-bold text-purple-700" id="leaseMonthly">$0</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">Total Over 36 Months</p>
                                    <p class="text-xl font-bold text-gray-900" id="leaseTotal">$0</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">Total with Fees</p>
                                    <p class="text-xl font-bold text-red-600" id="leaseTotalFees">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button onclick="prevStep()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
                                ‚Üê Previous
                            </button>
                            <button onclick="nextStep()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                                Next: 6-Year Comparison ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 5: 6-Year Total Cost Comparison -->
                <div class="wizard-content" id="step-5">
                    <div class="bg-white p-6 rounded-lg border-2 border-orange-200">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Step 5: 6-Year Total Cost Comparison</h3>

                        <div class="overflow-x-auto mb-6">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="border p-2 text-left">Cost Factor</th>
                                        <th class="border p-2 text-center bg-green-50">Buy New</th>
                                        <th class="border p-2 text-center bg-blue-50">Buy Used</th>
                                        <th class="border p-2 text-center bg-purple-50">Lease (√ó2)</th>
                                    </tr>
                                </thead>
                                <tbody class="text-sm">
                                    <tr>
                                        <td class="border p-2 font-medium">Monthly Payment</td>
                                        <td class="border p-2 text-center" id="comp-new-monthly">$0</td>
                                        <td class="border p-2 text-center" id="comp-used-monthly">$0</td>
                                        <td class="border p-2 text-center" id="comp-lease-monthly">$0</td>
                                    </tr>
                                    <tr>
                                        <td class="border p-2 font-medium">Total Paid (6 years)</td>
                                        <td class="border p-2 text-center" id="comp-new-total">$0</td>
                                        <td class="border p-2 text-center" id="comp-used-total">$0</td>
                                        <td class="border p-2 text-center" id="comp-lease-total">$0</td>
                                    </tr>
                                    <tr>
                                        <td class="border p-2 font-medium">Vehicle Value (Year 6)</td>
                                        <td class="border p-2 text-center text-green-600" id="comp-new-value">$0</td>
                                        <td class="border p-2 text-center text-green-600" id="comp-used-value">$0</td>
                                        <td class="border p-2 text-center text-red-600" id="comp-lease-value">$0</td>
                                    </tr>
                                    <tr>
                                        <td class="border p-2 font-medium">Maintenance (est.)</td>
                                        <td class="border p-2 text-center" id="comp-new-maint">$7,200</td>
                                        <td class="border p-2 text-center" id="comp-used-maint">$10,800</td>
                                        <td class="border p-2 text-center" id="comp-lease-maint">$3,600</td>
                                    </tr>
                                    <tr>
                                        <td class="border p-2 font-medium">Fuel (est.)</td>
                                        <td class="border p-2 text-center" id="comp-new-fuel">$0</td>
                                        <td class="border p-2 text-center" id="comp-used-fuel">$0</td>
                                        <td class="border p-2 text-center" id="comp-lease-fuel">$0</td>
                                    </tr>
                                    <tr class="bg-yellow-50 font-bold">
                                        <td class="border p-2">NET COST</td>
                                        <td class="border p-2 text-center text-lg" id="comp-new-net">$0</td>
                                        <td class="border p-2 text-center text-lg" id="comp-used-net">$0</td>
                                        <td class="border p-2 text-center text-lg" id="comp-lease-net">$0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="bg-white p-4 rounded-lg border mb-4">
                            <canvas id="comparisonChart" style="max-height: 300px;"></canvas>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400 mb-4">
                            <p class="text-sm text-gray-700" id="comp-insight">
                                <strong>üí° Analysis:</strong> Complete all scenarios to see which option offers the best value over 6 years.
                            </p>
                        </div>

                        <div class="flex space-x-4">
                            <button onclick="prevStep()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
                                ‚Üê Previous
                            </button>
                            <button onclick="nextStep()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                                Next: Get Recommendation ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Recommendation & Reflection -->
                <div class="wizard-content" id="step-6">
                    <div class="bg-white p-6 rounded-lg border-2 border-indigo-200">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Step 6: Recommendation & Reflection</h3>

                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg mb-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-3">üèÜ Financial Recommendation</h4>
                            <div id="recommendation-text" class="text-gray-700 mb-4">
                                Complete all scenarios to receive your personalized recommendation.
                            </div>
                            <div class="grid md:grid-cols-3 gap-4" id="recommendation-summary">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg border-2 border-blue-200 mb-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-3">üí≠ Your Reflection</h4>
                            <p class="text-gray-700 mb-3">
                                <strong>Prompt:</strong> Which option fits YOUR situation best and why? Consider your budget, driving habits, lifestyle, and financial goals.
                            </p>
                            <textarea
                                id="reflection"
                                rows="6"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                placeholder="Write your reflection here... Consider:
‚Ä¢ Your monthly budget and financial stability
‚Ä¢ Expected annual mileage
‚Ä¢ How long you plan to keep the vehicle
‚Ä¢ Whether you value ownership vs. flexibility
‚Ä¢ Your other financial goals (emergency fund, retirement, etc.)"
                            ></textarea>
                        </div>

                        <div class="flex space-x-4 mb-4">
                            <button onclick="printSummary()" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                                üñ®Ô∏è Print Summary
                            </button>
                            <button onclick="saveDecision()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                                üíæ Save My Decision
                            </button>
                        </div>

                        <div class="flex space-x-4">
                            <button onclick="prevStep()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
                                ‚Üê Previous
                            </button>
                            <button onclick="resetWizard()" class="flex-1 bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition">
                                üîÑ Start Over
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <section class="mb-8 bg-gray-50 p-6 rounded-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Summary</h2>
                <p class="text-gray-700 mb-4">
                    Vehicle acquisition represents a significant financial decision that extends far beyond the advertised monthly payment. The choice between buying and leasing involves careful consideration of total cost of ownership, including depreciation, financing costs, insurance, maintenance, and opportunity costs.
                </p>
                <p class="text-gray-700 mb-4">
                    Buying typically results in lower long-term costs and builds equity, particularly if you keep the vehicle beyond the loan payoff period. Leasing offers lower monthly payments and the flexibility of regularly updated vehicles but results in perpetual payments with no asset accumulation.
                </p>
                <p class="text-gray-700">
                    The most financially sound approach often involves purchasing a reliable vehicle‚Äîwhether new or used‚Äîkeeping it well-maintained, and continuing to drive it after the loan is paid off. The years of payment-free driving can substantially reduce lifetime vehicle costs and free up resources for other financial goals.
                </p>
            </section>
        </div>
    </div>

    <script>
        // Wizard state
        let currentStep = 1;
        const totalSteps = 6;

        // State variables (replace with actual values)
        const STATE_NAME = "California";
        const AVG_AUTO_LOAN_RATE_NEW = "5.8";
        const AVG_AUTO_LOAN_RATE_USED = "7.2";
        const REGISTRATION_INITIAL = "$450";
        const REGISTRATION_ANNUAL = "$150";
        const SALES_TAX = "7.25";
        const GAS_PRICE_CURRENT = "$4.50";

        // Data storage
        let wizardData = {
            buyNew: {},
            buyUsed: {},
            lease: {}
        };

        // Wizard navigation
        function goToStep(step) {
            if (step < 1 || step > totalSteps) return;

            // Hide all steps
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById(`step-${i}`).classList.remove('active');
                document.getElementById(`step-tab-${i}`).classList.remove('active');
            }

            // Show target step
            document.getElementById(`step-${step}`).classList.add('active');
            document.getElementById(`step-tab-${step}`).classList.add('active');
            currentStep = step;

            // Update comparison chart if on step 5
            if (step === 5) {
                updateComparison();
            }

            // Update recommendation if on step 6
            if (step === 6) {
                updateRecommendation();
            }
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                // Mark current step as completed
                document.getElementById(`step-tab-${currentStep}`).classList.add('completed');
                goToStep(currentStep + 1);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                goToStep(currentStep - 1);
            }
        }

        // Calculate Buy New
        function calculateBuyNew() {
            const price = parseFloat(document.getElementById('newPrice').value) || 0;
            const downPct = parseFloat(document.getElementById('newDown').value) || 0;
            const term = parseInt(document.getElementById('newTerm').value) || 60;
            const apr = parseFloat(document.getElementById('newAPR').value) || 0;

            const salesTax = price * (parseFloat(SALES_TAX) / 100);
            const regFee = 450;
            const docFee = 500;
            const totalPrice = price + salesTax + regFee + docFee;

            const downPayment = totalPrice * (downPct / 100);
            const loanAmount = totalPrice - downPayment;
            const monthlyRate = (apr / 100) / 12;

            let monthly = 0;
            if (monthlyRate > 0) {
                monthly = (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, term)) /
                         (Math.pow(1 + monthlyRate, term) - 1);
            } else {
                monthly = loanAmount / term;
            }

            const totalPaid = (monthly * term) + downPayment;
            const totalInterest = (monthly * term) - loanAmount;

            document.getElementById('newMonthly').textContent = '$' + monthly.toFixed(0);
            document.getElementById('newInterest').textContent = '$' + totalInterest.toFixed(0);
            document.getElementById('newTotal').textContent = '$' + totalPaid.toFixed(0);

            // Store data
            wizardData.buyNew = {
                price,
                monthly,
                totalPaid,
                term,
                vehicleValue: price * 0.40 // 40% residual after 6 years for new
            };
        }

        // Calculate Buy Used
        function calculateBuyUsed() {
            const price = parseFloat(document.getElementById('usedPrice').value) || 0;
            const downPct = parseFloat(document.getElementById('usedDown').value) || 0;
            const term = parseInt(document.getElementById('usedTerm').value) || 48;
            const apr = parseFloat(document.getElementById('usedAPR').value) || 0;

            const salesTax = price * (parseFloat(SALES_TAX) / 100);
            const regFee = 450;
            const totalPrice = price + salesTax + regFee;

            const downPayment = totalPrice * (downPct / 100);
            const loanAmount = totalPrice - downPayment;
            const monthlyRate = (apr / 100) / 12;

            let monthly = 0;
            if (monthlyRate > 0) {
                monthly = (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, term)) /
                         (Math.pow(1 + monthlyRate, term) - 1);
            } else {
                monthly = loanAmount / term;
            }

            const totalPaid = (monthly * term) + downPayment;
            const totalInterest = (monthly * term) - loanAmount;

            document.getElementById('usedMonthly').textContent = '$' + monthly.toFixed(0);
            document.getElementById('usedInterest').textContent = '$' + totalInterest.toFixed(0);
            document.getElementById('usedTotal').textContent = '$' + totalPaid.toFixed(0);

            // Store data
            wizardData.buyUsed = {
                price,
                monthly,
                totalPaid,
                term,
                vehicleValue: price * 0.25 // 25% residual after 6 years for used
            };
        }

        // Calculate Lease
        function calculateLease() {
            const msrp = parseFloat(document.getElementById('leaseMSRP').value) || 0;
            const capCost = parseFloat(document.getElementById('leaseCapCost').value) || 0;
            const residualPct = parseFloat(document.getElementById('leaseResidual').value) || 60;
            const moneyFactor = parseFloat(document.getElementById('leaseMoneyFactor').value) || 0.00250;
            const term = parseInt(document.getElementById('leaseTerm').value) || 36;

            // Update APR display
            const apr = moneyFactor * 2400;
            document.getElementById('leaseAPR').textContent = apr.toFixed(1);

            const residualValue = msrp * (residualPct / 100);
            const depreciation = capCost - residualValue;
            const depreciationMonthly = depreciation / term;
            const financeCharge = (capCost + residualValue) * moneyFactor;
            const baseMonthly = depreciationMonthly + financeCharge;

            const salesTaxRate = parseFloat(SALES_TAX) / 100;
            const monthly = baseMonthly * (1 + salesTaxRate);

            const totalOverTerm = monthly * term;
            const regFees = 150 * (term / 12);
            const dispositionFee = 500;
            const totalWithFees = totalOverTerm + regFees + dispositionFee;

            document.getElementById('leaseMonthly').textContent = '$' + monthly.toFixed(0);
            document.getElementById('leaseTotal').textContent = '$' + totalOverTerm.toFixed(0);
            document.getElementById('leaseTotalFees').textContent = '$' + totalWithFees.toFixed(0);

            // Store data for 6-year comparison (2 leases)
            wizardData.lease = {
                monthly,
                totalPaid: totalWithFees * 2, // Two 3-year leases
                term,
                vehicleValue: 0 // No ownership
            };
        }

        // Update comparison table and chart
        let comparisonChart = null;

        function updateComparison() {
            // Estimate fuel costs (12,000 miles/year, 25 mpg, gas price)
            const gasPrice = parseFloat(GAS_PRICE_CURRENT.replace('$', ''));
            const annualFuel = (12000 / 25) * gasPrice;
            const sixYearFuel = annualFuel * 6;

            // Buy New
            const newMonthly = wizardData.buyNew.monthly || 0;
            const newTotal = wizardData.buyNew.totalPaid || 0;
            const newValue = wizardData.buyNew.vehicleValue || 0;
            const newMaint = 7200; // $100/mo √ó 72 months
            const newNet = newTotal + newMaint + sixYearFuel - newValue;

            document.getElementById('comp-new-monthly').textContent = '$' + newMonthly.toFixed(0);
            document.getElementById('comp-new-total').textContent = '$' + newTotal.toFixed(0);
            document.getElementById('comp-new-value').textContent = '$' + newValue.toFixed(0);
            document.getElementById('comp-new-fuel').textContent = '$' + sixYearFuel.toFixed(0);
            document.getElementById('comp-new-net').textContent = '$' + newNet.toFixed(0);

            // Buy Used
            const usedMonthly = wizardData.buyUsed.monthly || 0;
            const usedTotal = wizardData.buyUsed.totalPaid || 0;
            const usedValue = wizardData.buyUsed.vehicleValue || 0;
            const usedMaint = 10800; // $150/mo √ó 72 months
            const usedNet = usedTotal + usedMaint + sixYearFuel - usedValue;

            document.getElementById('comp-used-monthly').textContent = '$' + usedMonthly.toFixed(0);
            document.getElementById('comp-used-total').textContent = '$' + usedTotal.toFixed(0);
            document.getElementById('comp-used-value').textContent = '$' + usedValue.toFixed(0);
            document.getElementById('comp-used-fuel').textContent = '$' + sixYearFuel.toFixed(0);
            document.getElementById('comp-used-net').textContent = '$' + usedNet.toFixed(0);

            // Lease
            const leaseMonthly = wizardData.lease.monthly || 0;
            const leaseTotal = wizardData.lease.totalPaid || 0;
            const leaseValue = 0;
            const leaseMaint = 3600; // $50/mo √ó 72 months (covered by warranty)
            const leaseNet = leaseTotal + leaseMaint + sixYearFuel;

            document.getElementById('comp-lease-monthly').textContent = '$' + leaseMonthly.toFixed(0);
            document.getElementById('comp-lease-total').textContent = '$' + leaseTotal.toFixed(0);
            document.getElementById('comp-lease-value').textContent = '$0';
            document.getElementById('comp-lease-fuel').textContent = '$' + sixYearFuel.toFixed(0);
            document.getElementById('comp-lease-net').textContent = '$' + leaseNet.toFixed(0);

            // Update insight
            const costs = [
                { name: 'Buy New', cost: newNet },
                { name: 'Buy Used', cost: usedNet },
                { name: 'Lease', cost: leaseNet }
            ];
            costs.sort((a, b) => a.cost - b.cost);

            const savingsVsWorst = costs[2].cost - costs[0].cost;
            document.getElementById('comp-insight').innerHTML =
                `<strong>üí° Analysis:</strong> <strong>${costs[0].name}</strong> has the lowest net cost at $${costs[0].cost.toFixed(0)},
                saving you $${savingsVsWorst.toFixed(0)} compared to ${costs[2].name} over 6 years.`;

            // Update chart
            if (comparisonChart) {
                comparisonChart.destroy();
            }

            const ctx = document.getElementById('comparisonChart').getContext('2d');
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Buy New', 'Buy Used/CPO', 'Lease (√ó2)'],
                    datasets: [{
                        label: 'Net Cost Over 6 Years',
                        data: [newNet, usedNet, leaseNet],
                        backgroundColor: ['#10b981', '#3b82f6', '#a855f7'],
                        borderWidth: 2,
                        borderColor: ['#059669', '#2563eb', '#7c3aed']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Net Cost: $' + context.parsed.y.toFixed(0).toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Store for recommendation
            wizardData.comparison = costs;
        }

        // Update recommendation
        function updateRecommendation() {
            if (!wizardData.comparison || wizardData.comparison.length === 0) {
                return;
            }

            const best = wizardData.comparison[0];
            const worst = wizardData.comparison[2];
            const savings = worst.cost - best.cost;

            let recommendation = '';
            if (best.name === 'Buy New') {
                recommendation = `Based on your calculations, <strong>buying new</strong> offers the best long-term value with a net cost of <strong>$${best.cost.toFixed(0)}</strong> over 6 years. You'll build equity and have a reliable vehicle under warranty. This option works best if you plan to keep the vehicle long-term after paying off the loan.`;
            } else if (best.name === 'Buy Used') {
                recommendation = `Based on your calculations, <strong>buying used/CPO</strong> is your best financial choice with a net cost of only <strong>$${best.cost.toFixed(0)}</strong> over 6 years. You avoid the steepest depreciation and still build ownership. This is ideal for budget-conscious buyers who want to own their vehicle.`;
            } else {
                recommendation = `Based on your calculations, <strong>leasing</strong> has the lowest net cost at <strong>$${best.cost.toFixed(0)}</strong> over 6 years. However, you'll have no asset at the end. Leasing makes sense if you value always having a new vehicle and don't drive many miles.`;
            }

            recommendation += ` You'll save <strong>$${savings.toFixed(0)}</strong> compared to ${worst.name}.`;

            document.getElementById('recommendation-text').innerHTML = recommendation;

            // Summary cards
            const summaryHTML = wizardData.comparison.map((item, idx) => {
                const badge = idx === 0 ? 'üèÜ Best Value' : idx === 1 ? '2nd Place' : '3rd Place';
                const bgColor = idx === 0 ? 'bg-green-50' : idx === 1 ? 'bg-blue-50' : 'bg-red-50';
                return `
                    <div class="${bgColor} p-4 rounded-lg border">
                        <div class="text-xs font-semibold mb-1">${badge}</div>
                        <div class="font-bold text-gray-900">${item.name}</div>
                        <div class="text-xl font-bold text-gray-700">$${item.cost.toFixed(0)}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('recommendation-summary').innerHTML = summaryHTML;
        }

        // Save decision
        function saveDecision() {
            const reflection = document.getElementById('reflection').value;
            if (!reflection.trim()) {
                alert('‚ö†Ô∏è Please write your reflection before saving.');
                return;
            }

            const decision = {
                ...wizardData,
                reflection,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('auto-finance-decision', JSON.stringify(decision));
            alert('‚úÖ Your decision has been saved! You can review it anytime.');
        }

        // Print summary
        function printSummary() {
            window.print();
        }

        // Reset wizard
        function resetWizard() {
            if (confirm('Are you sure you want to start over? This will clear all your inputs.')) {
                // Reset all forms
                document.getElementById('targetPrice').value = '30000';
                document.getElementById('newPrice').value = '30000';
                document.getElementById('newDown').value = '20';
                document.getElementById('newTerm').value = '60';
                document.getElementById('newAPR').value = AVG_AUTO_LOAN_RATE_NEW;

                document.getElementById('usedPrice').value = '20000';
                document.getElementById('usedDown').value = '10';
                document.getElementById('usedTerm').value = '48';
                document.getElementById('usedAPR').value = AVG_AUTO_LOAN_RATE_USED;

                document.getElementById('leaseMSRP').value = '30000';
                document.getElementById('leaseCapCost').value = '28000';
                document.getElementById('leaseResidual').value = '60';
                document.getElementById('leaseMoneyFactor').value = '0.00250';
                document.getElementById('leaseTerm').value = '36';

                document.getElementById('reflection').value = '';

                // Reset wizard data
                wizardData = {
                    buyNew: {},
                    buyUsed: {},
                    lease: {}
                };

                // Reset all step tabs
                for (let i = 1; i <= totalSteps; i++) {
                    document.getElementById(`step-tab-${i}`).classList.remove('completed');
                }

                // Go to step 1
                goToStep(1);

                // Recalculate
                calculateBuyNew();
                calculateBuyUsed();
                calculateLease();
            }
        }

        // Progress tracking
        const sections = ['intro', 'key-concepts', 'buying', 'leasing', 'comparing', 'implications', 'examples', 'reflection', 'skill-builder'];
        const viewedSections = new Set();

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && entry.target.id) {
                    viewedSections.add(entry.target.id);
                    updateProgress();
                }
            });
        }, { threshold: 0.5 });

        sections.forEach(id => {
            const el = document.getElementById(id);
            if (el) observer.observe(el);
        });

        function updateProgress() {
            const progress = (viewedSections.size / sections.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${viewedSections.size}/${sections.length} sections`;
        }

        // Initialize calculations on page load
        window.addEventListener('DOMContentLoaded', function() {
            calculateBuyNew();
            calculateBuyUsed();
            calculateLease();
        });
    </script>
</body>
</html>
